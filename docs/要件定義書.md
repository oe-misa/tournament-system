# 大会運営システム 要件定義書

## 1. 目的
大会情報の公開、会員のログイン・大会エントリー・成績閲覧・プロフィール管理・年間登録更新を一元化する。
運営（管理者）は大会管理、成績入力、段位申請の承認/却下を行う。

## 2. 技術スタック
- Backend: Laravel（Blade + MVC）
- Auth: Laravel Breeze（Webログイン）
- DB: MySQL（開発環境）
- Front: Blade（将来的に Next.js/React へ移行可能な構成で進行）
- 開発: VSCode / GitHub

## 3. ユーザー種別と権限
### 会員（ログイン必須）
- 大会一覧閲覧（ログイン後）
- 大会詳細閲覧（ログイン後）
- 大会へのエントリー
- 自身の過去成績の閲覧
- プロフィールの編集（日本語UI、段位も表示）
- 年間登録の更新
- 段位申請（自分の段位以上のみ申請可）
- 段位申請の履歴閲覧（ステータス/担当者/日付/コメント表示）

### 管理者（is_admin = true）
- 管理者ダッシュボード（未処理件数バッジ等）
- 大会管理（作成/編集/公開/締切等）
- 成績入力（大会ごと）
- 段位申請管理（履歴含む）
  - 未処理の承認/却下
  - コメント入力（管理者コメント）
  - 処理後は履歴として残し、会員側にも表示
  - 承認時にユーザー段位を自動更新

## 4. 機能要件

### 4.1 認証
- Breeze によるログイン/ログアウト
- 認証必須ページは未ログイン時にログインへリダイレクト

### 4.2 大会（会員）
- 大会一覧：開催日/参加条件/募集状況を表示
- 大会詳細：大会の詳細表示、エントリー導線
- 参加条件表示：
  - DB上の条件は rank level（数値）だが、表示は級/段（例「A,B級」）に変換して表示

### 4.3 大会エントリー（会員）
- ログインユーザーが大会へエントリー可能
- 大会ごとに「参加可能な最低段位（min_rank_level）」を設定
- エントリー時はユーザー段位levelと大会min_rank_levelで参加可否判定

### 4.4 成績（会員）
- 自身の過去成績一覧を閲覧

### 4.5 プロフィール（会員）
- 日本語表示
- 現在の段位表示（ラベル変換）
- 年間登録期限表示

### 4.6 年間登録更新（会員）
- 年間登録期限の更新（membership_expires_at を更新）

### 4.7 段位定義
- 段位は数値レベル 0〜10 を基本とする
- 表示ルール（級/段の対応）：
  - 0: 無段（F〜E級）
  - 1: 初段（D級）
  - 2: 弐段（C級）
  - 3: 参段（B級）
  - 4〜10: A級（四段〜十段）
- 大会参加条件表示の変換例：
  - min=3 → 「A,B級」
  - min=4 → 「A級」

### 4.8 段位申請（会員）
- 申請フォームで申請段位を選択
- 自分の現在段位以上のみ選択可能（UIで無効化＋サーバ側でも拒否）
- 選択時に段位定義をサーバから取得しプレビュー表示
- 申請は未処理として保存し、履歴で確認可能

### 4.9 段位申請管理（管理者）
- 申請一覧（履歴含む）を表示
- 表示項目：
  - 申請者 / 申請段位 / ステータス / 担当者 / 日付（YYMMDD）/ コメント
- 未処理の申請は承認/却下操作が可能
- 操作時に管理者コメント入力が可能
- 承認時はユーザー段位（users.rank_id）を自動更新
- 処理後は「処理済み」として履歴に残る

## 5. 画面（概要）
- ダッシュボード（会員メニュー・管理者メニュー）
- 大会一覧/詳細
- 成績一覧
- プロフィール
- 年間登録更新
- 段位申請（作成）
- 段位申請履歴（会員）
- 管理者：ダッシュボード
- 管理者：大会管理
- 管理者：段位申請管理（履歴）

## 6. ルーティング（代表）
- 会員
  - GET /dashboard
  - GET /tournaments
  - GET /results
  - GET /profile
  - GET /membership/renew
  - GET /rank-requests
  - POST /rank-requests
  - GET /rank-requests/history
  - GET /rank-definitions/{rank}
- 管理者（/admin）
  - GET /admin
  - GET /admin/tournaments
  - GET /admin/rank-requests
  - POST /admin/rank-requests/{id}/approve
  - POST /admin/rank-requests/{id}/reject

